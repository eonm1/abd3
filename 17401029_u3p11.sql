/*
Autor: Erick Octavio Nolasco Machuca
Practica: 11
NO Control: 17401029
*/

/*Crea una BD ALUMNOS2020 con el sig esquema*/
Create database ALUMNOS2020
On Primary
(
Name='ALUMNOS2020.MDF',
FileName='C:\BD\ALUMNOS2020.MDF'
)
log on
(
Name='ALUMNOS2020.LDF',
FileName='C:\BD\ALUMNOS2020.LDF'
)
Go

use ALUMNOS2020
GO

/*Creacion de las tablas*/

	Create table ALUMNO
	(
		ALU_NOCTRL VARCHAR(8) NOT NULL PRIMARY KEY,
		ALU_APEPAT VARCHAR(30),
		ALU_APEMAT VARCHAR(30),
		ALU_NOMBRE VARCHAR(30),
		CAR_ID TINYINT,
		ALU_SEMEST TINYINT
	)
	go
	Create Table CARRERA
	(
		CAR_ID TINYINT NOT NULL PRIMARY KEY IDENTITY(1,1),
		CAR_CLAVE CHAR(5),
		CAR_NOMBRE VARCHAR(50)
	)
	GO
	CREATE tABLE CONTROL_TAREA
	(
		CTRL_ID INT PRIMARY KEY,
		CTRL_UNIDAD TINYINT,
		CTRL_TAREAS TINYINT,
		CTRL_ESTATUS char(1),
		CTRL_CALIFICACION SMALLINT,
		ALU_NOCTRL VARCHAR(8)
	)
	go

/*Relaciones*/

alter table ALUMNO add foreign key (CAR_ID) references CARRERA(CAR_ID)
go

alter table CONTROL_TAREA add foreign key (ALU_NOCTRL) references ALUMNO (ALU_NOCTRL)
go

/*Insertar carrreras*/
	INSERT INTO CARRERA VALUES ('ISC','INGENIERIA EN SISTEMAS COMPUTACIONALES'),
	('IC','INGENIERIA CIVIL'),('IE','INGENIERIA ELECTRIA'),('IGE','INGENIERIA EN GESTION EMPRESARIAL'),
	('IBQ','INGENIERIA BIOQUIMICA')
	GO

/*Insertar los alumnos de ISC*/
INSERT INTO ALUMNO VALUES
('17400997','INDA','OLVERA','MARTHA ELIZABETH',1,6),
('17400999','JIMENEZ','PEREZ','EMANUEL JOSAFAT',1,6),
('17401018','MENDEZ','CASTELLANOS','LUIS DANIEL',1,6),
('17401019','MEZA','LUNA','EDSON DARIEL',1,6),
('17401022','MIRAMONTES','ALVAREZ','FERNANDO',1,6),
('17401029','NOLASCO','MACHUCA','ERICK OCTAVIO',1,6),
('17401031','NOVA','RAMIREZ','PAULINA ALEJANDRA',1,6),
('17401052','RAMIREZ','HERNANDEZ','ALEJANDRO ANTONIO',1,6),
('17401056','RANGEL','CANTABRANA','ALFONSO ALDAIR',1,6),
('17401062','RIVERA','FLORES','OMAR OSWALDO',1,6)
GO

/* EN LA TABLA ALUMNOS CREA UN INDICICE CLUSTEREADO CON EL
APELLIDO PATERNO, APELLIDO MATERNO Y NOMBRE
*/

CREATE CLUSTERED INDEX OBJ_NOMBREC on ALUMNO (ALU_APEPAT,ALU_APEMAT,ALU_NOMBRE)
GO

/*EL INDICE POR NUMERO DE CONTROL DEBE QUEDAR TAMBIEN EN LA
TABLA.*/

exec sp_helpindex ALUMNO
go

/*CREAR OTRO INDICE POR CARRERA Y SEMESTRE*/

Create nonclustered index OBJ_CARRERASEM on ALUMNO (CAR_ID,ALU_SEMEST)
go

/*INSERTE AL MENOS 10 ALUMNOS DE CIVIL, 15 DE ING. EN GESTION
EMPRESARIAL, 8 DE INGENIERIA ELECTRICA, 12 DE INGENIERIA
BIOQUIMICA.*/

insert into ALUMNO values ('17401111','PEREZ','SANCHEZ','JUAN DANIEL',2,6),
('17401112','BRISEÑO','CHAVEZ','ALAN',2,6),
('17401113','BECERRA','ARELLANO','KARYME',2,4),
('17401114','AMANDA','SANCHEZ','MIGUEL',2,5),
('17401115','MUSICA','TORESTAKI','BILLIE',2,7),
('17401116','TRISTEZA','ENRIQUEZ','YOUHALME',2,6),
('17401117','HANGIN','ON','LIL SUPA',2,6),
('17401118','RAZER','WUHAN','STEAL MAX',2,6),
('17401119','OU','YOU','HAI',2,6),
('1740111A','PERLA','RIO','JAIME',2,6),


('1740111B','SNOP','DOG','SKETCHER',4,6),
('1740111C','THIS','IS','REAL',4,5),
('1740111D','IN','MY','HEART',4,6),
('1740111E','VILLANUEVA','GONZALEZ','QUETZALLI',4,8),
('1740111F','RIOS','ARELLANO','PILAR',4,8),
('1740111G','HOLA','YA','MENFADE',4,6),
('1740111H','OUU','FEIT','SHEI',4,6),
('1740111I','WHEN','YOU','OK',4,6),
('1740111J','JACKSON','KEIN','SAMUEL',4,4),
('1740111K','ENRIQUEZ','CASTRO','JOSE CARLOS',4,7),
('1740111L','SOME','DAY','IPAY',4,6),
('1740111M','LONELY','CHAN','DANIEL',4,8),
('1740111N','HERNANDEZ','JIMENEZ','MARTIN',4,6),
('1740111O','LOPEZ','CIGALA','JENIFER',4,6),
('1740111P','OCEAN','ICE','ENRIQUETA',4,6),

('17403111','LET','MECRY','SKELER',3,6),
('17403112','GIVEME','ARASON','JUSTIN',3,6),
('17403113','BENITEZ','KAELYKE','KOPALES',3,6),
('17403114','PLASTERING','QUINTERO','JHARED',3,6),
('17403115','IMSCARED','MIRAMONTES','JHONATAN',3,6),
('17403116','ALGUIEN','MEAMO','JESSIE',3,8),
('17403117','COMISARIO','ALTO','WOODY',3,5),
('17403118','LIKE','LIKESAY','ELISH',3,8),


('1750111B','SNOP','DOG','SKETCHER',5,6),
('1750111C','THIS','IS','REAL',5,5),
('1750111D','IN','MY','HEART',5,6),
('1750111E','VILLANUEVA','GONZALEZ','QUETZALLI',5,8),
('1750111F','RIOS','ARELLANO','PILAR',5,8),
('1750111G','HOLA','YA','MENFADE',5,6),
('1750111H','OUU','FEIT','SHEI',5,6),
('1750111I','WHEN','YOU','OK',5,6),
('17503111','LET','MECRY','SKELER',5,6),
('17503112','GIVEME','ARASON','JUSTIN',5,6),
('17503113','BENITEZ','KAELYKE','KOPALES',5,6),
('17503118','LIKE','LIKESAY','ELISH',5,8)
go

/*EN LAS CONSUSLTA VERIFIQUE LOS PLANES DE EJECUCIÓN
 CONSULTA APELLIDO PATERNO, APELLIDO MATERNO Y NOMBRE DE LOS
ALUMNOS QUE ESTEN EN EL SEMESTRE 6 Y QUE PERTENEZCAN A ISC.*/

select ALU_APEPAT,ALU_APEMAT,ALU_NOMBRE FROM ALUMNO WHERE ALU_SEMEST = 6
AND CAR_ID=1

/*CUENTE CUANTOS ALUMNOS HAY POR CARRERA Y POR SEMESTRE.
MOSTRANDO UNA LISTA COMO LA SIGUIENTE, MUESTREE EL PLAN DE
EJECUCIÓN*/

Select  (C.CAR_NOMBRE),(A.ALU_SEMEST),count(*) AS 'CANTIDAD'
from ALUMNO A
inner join CARRERA C on (C.CAR_ID = A.CAR_ID)
group by C.CAR_NOMBRE,A.ALU_SEMEST

/*Mostrar cuantos indices tiene cada tabla*/
exec sp_helpindex 'ALUMNO'
exec sp_helpindex 'CARRERA'
exec sp_helpindex 'CONTROL_TAREA'